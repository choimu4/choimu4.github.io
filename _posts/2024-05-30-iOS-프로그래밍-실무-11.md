---
layout: post
title: iOS í”„ë¡œê·¸ë˜ë° ì‹¤ë¬´ 11
subtitle: iOS í”„ë¡œê·¸ë˜ë° ì‹¤ë¬´ 11
author: ë¯¼ìš± ìµœ 
excerpt_image: ../assets/images/swift_banner.PNG
categories: Swift
banner:
  image: ../assets/images/swift_banner.PNG
  opacity: 0.618
  background: "#000"
  height: "100vh"
  min_height: "38vh"
  heading_style: "font-size: 3.5em; font-weight: bold; text-decoration: underline"
  subheading_style: "color: gold"
tags: iOS Swift Induk
---
       
## BoxOffice App
---

### MVC 

Model
``` Swift
import Foundation

// Codableì„ ì¤€ìˆ˜í•˜ëŠ” êµ¬ì¡°ì²´ ì •ì˜
// ì˜í™” ë°ì´í„°ë¥¼ ë‹´ëŠ” êµ¬ì¡°ì²´
struct MovieData : Codable {
    let boxOfficeResult : BoxOfficeResult
}

// ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ê²°ê³¼ë¥¼ ë‹´ëŠ” êµ¬ì¡°ì²´
struct BoxOfficeResult : Codable {
    let dailyBoxOfficeList : [DailyBoxOfficeList]
}

// ì¼ì¼ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ë‹´ëŠ” êµ¬ì¡°ì²´
struct DailyBoxOfficeList : Codable {
    let movieNm : String  // ì˜í™” ì œëª©
    let audiCnt : String  // ì–´ì œ ê´€ê° ìˆ˜
    let audiAcc : String  // ëˆ„ì  ê´€ê° ìˆ˜
    let rank : String     // ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ìˆœìœ„
}

// ì˜í™” ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤
class MovieDataManager {
    var movieData: MovieData?
    let movieURLBase = "https://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=d9dfbf5b0a8b138015b48bd3b9ecfe2b&targetDt="
    
    func fetchMovieData(completion: @escaping (MovieData?) -> Void) {
        let movieURL = movieURLBase + makeYesterdayString()
        guard let url = URL(string: movieURL) else { return }
        
        let session = URLSession(configuration: .default)
        let task = session.dataTask(with: url) { data, response, error in
            if error != nil {
                print(error!)
                completion(nil)
                return
            }
            guard let JSONdata = data else {
                completion(nil)
                return
            }
            
            let decoder = JSONDecoder()
            do {
                let decodedData = try decoder.decode(MovieData.self, from: JSONdata)
                completion(decodedData)
            } catch {
                print(error)
                completion(nil)
            }
        }
        task.resume()
    }
    
    private func makeYesterdayString() -> String {
        let today = Date()
        let calendar = Calendar.current
        let yesterday = calendar.date(byAdding: .day, value: -1, to: today)!
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyyMMdd"
        return formatter.string(from: yesterday)
    }
}
```

View

``` Swift
import UIKit

class MyTableViewCell: UITableViewCell {
    @IBOutlet weak var movieName: UILabel!
    @IBOutlet weak var audiAccumulate: UILabel!
    @IBOutlet weak var audiCount: UILabel!
}

```

Controller

```Swift
import UIKit

class ViewController: UIViewController, UITableViewDelegate, UITableViewDataSource {
    
    @IBOutlet weak var table: UITableView!
    var movieDataManager = MovieDataManager()
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        // í…Œì´ë¸” ë·°ì˜ ë°ì´í„° ì†ŒìŠ¤ì™€ ë¸ë¦¬ê²Œì´íŠ¸ ì„¤ì •
        table.dataSource = self
        table.delegate = self
        
        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë©”ì†Œë“œ í˜¸ì¶œ
        movieDataManager.fetchMovieData { [weak self] data in
            guard let self = self else { return }
            self.movieDataManager.movieData = data
            
            // ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ í…Œì´ë¸” ë·° ë¦¬ë¡œë“œ
            DispatchQueue.main.async {
                self.table.reloadData()
            }
        }
    }
    
    // í…Œì´ë¸” ë·°ì˜ ì„¹ì…˜ë‹¹ í–‰ì˜ ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œ
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return movieDataManager.movieData?.boxOfficeResult.dailyBoxOfficeList.count ?? 0
    }
    
    // ê° í–‰ì— ëŒ€í•œ ì…€ì„ êµ¬ì„±í•˜ëŠ” ë©”ì†Œë“œ
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = tableView.dequeueReusableCell(withIdentifier: "myCell", for: indexPath) as! MyTableViewCell
        
        // ì˜í™” ìˆœìœ„, ì´ë¦„, ëˆ„ì  ê´€ê° ìˆ˜, ì–´ì œ ê´€ê° ìˆ˜ ì„¤ì •
        guard let movie = movieDataManager.movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row] else { return UITableViewCell() }
        
        cell.movieName.text = "[\(movie.rank)ìœ„] \(movie.movieNm)"
        
        if let aAcc = Int(movie.audiAcc) {
            let numF = NumberFormatter()
            numF.numberStyle = .decimal
            cell.audiAccumulate.text = "ëˆ„ì  : \(numF.string(from: NSNumber(value: aAcc))!)ëª…"
        }
        
        if let aCnt = Int(movie.audiCnt) {
            let numF = NumberFormatter()
            numF.numberStyle = .decimal
            cell.audiCount.text = "ì–´ì œ : \(numF.string(from: NSNumber(value: aCnt))!)ëª…"
        }
        
        return cell
    }
    
    // í…Œì´ë¸” ë·°ì˜ ì„¹ì…˜ ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œ
    func numberOfSections(in tableView: UITableView) -> Int {
        return 1
    }
    
    // í…Œì´ë¸” ë·°ì˜ í–‰ì´ ì„ íƒë˜ì—ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œ
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        // ì„ íƒëœ í–‰ì— ëŒ€í•œ ì²˜ë¦¬
    }
    
    // í…Œì´ë¸” ë·°ì˜ ì„¹ì…˜ í—¤ë” ì œëª©ì„ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œ
    func tableView(_ tableView: UITableView, titleForHeaderInSection section: Int) -> String? {
        return "ğŸ¿ë°•ìŠ¤ì˜¤í”¼ìŠ¤(ì˜í™”ì§„í¥ìœ„ì›íšŒì œê³µ:" + movieDataManager.makeYesterdayString() + ")ğŸ¿"
    }
    
    // í…Œì´ë¸” ë·°ì˜ ì„¹ì…˜ í‘¸í„° ì œëª©ì„ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œ
    func tableView(_ tableView: UITableView, titleForFooterInSection section: Int) -> String? {
        return "by choimu"
    }
    
    // ì„¸ê·¸ì›¨ì´ë¥¼ ì¤€ë¹„í•˜ëŠ” ë©”ì†Œë“œ
    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
        let dest = segue.destination as! DetailViewController
        
        // ì„ íƒëœ í–‰ì˜ ì¸ë±ìŠ¤ ê²½ë¡œë¥¼ ê°€ì ¸ì™€ì„œ ì˜í™” ì´ë¦„ ì „ë‹¬
        let myIndexPath = table.indexPathForSelectedRow!
        let row = myIndexPath.row
        dest.movieName = (movieDataManager.movieData?.boxOfficeResult.dailyBoxOfficeList[row].movieNm)!
    }
}
```
### Refactoring

``` Swift
//
//  ViewController.swift
//  MovieCMU
//
//  Created by Induk-cs  on 2024/05/02.
//

import UIKit

struct MovieData: Codable {
    let boxOfficeResult: BoxOfficeResult
}

struct BoxOfficeResult: Codable {
    let dailyBoxOfficeList: [DailyBoxOfficeList]
}

struct DailyBoxOfficeList: Codable {
    let movieNm: String
    let audiCnt: String
    let audiAcc: String
    let rank: String
}

class ViewController: UIViewController, UITableViewDelegate, UITableViewDataSource {
    @IBOutlet weak var table: UITableView!
    var movieData: MovieData?
    let movieURL = "https://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=d9dfbf5b0a8b138015b48bd3b9ecfe2b&targetDt="

    override func viewDidLoad() {
        super.viewDidLoad()
        table.dataSource = self
        table.delegate = self
        
        let yesterdayString = makeYesterdayString()
        getData(from: movieURL + yesterdayString)
    }

    func makeYesterdayString() -> String {
        let calendar = Calendar.current
        guard let yesterday = calendar.date(byAdding: .day, value: -1, to: Date()) else { return "" }
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyyMMdd"
        return formatter.string(from: yesterday)
    }

    func getData(from urlString: String) {
        guard let url = URL(string: urlString) else { return }
        let session = URLSession(configuration: .default)
        let task = session.dataTask(with: url) { data, response, error in
            if let error = error {
                print(error)
                return
            }
            guard let JSONdata = data else { return }
            let decoder = JSONDecoder()
            do {
                let decodedData = try decoder.decode(MovieData.self, from: JSONdata)
                self.movieData = decodedData
                DispatchQueue.main.async {
                    self.table.reloadData()
                }
            } catch {
                print(error)
            }
        }
        task.resume()
    }

    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return movieData?.boxOfficeResult.dailyBoxOfficeList.count ?? 0
    }

    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        guard let cell = tableView.dequeueReusableCell(withIdentifier: "myCell", for: indexPath) as? MyTableViewCell else {
            return UITableViewCell()
        }
        let movie = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row]
        cell.movieName.text = "[\(movie?.rank ?? "")ìœ„] \(movie?.movieNm ?? "")"
        cell.audiAccumulate.text = "ëˆ„ì : \(formatNumber(movie?.audiAcc ?? ""))ëª…"
        cell.audiCount.text = "ì–´ì œ: \(formatNumber(movie?.audiCnt ?? ""))ëª…"
        return cell
    }

    func formatNumber(_ numberString: String) -> String {
        guard let number = Int(numberString) else { return numberString }
        let formatter = NumberFormatter()
        formatter.numberStyle = .decimal
        return formatter.string(from: NSNumber(value: number)) ?? numberString
    }

    func numberOfSections(in tableView: UITableView) -> Int {
        return 1
    }

    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        // ì„ íƒëœ ì…€ì— ëŒ€í•œ ì‘ì—…ì„ ì—¬ê¸°ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    }

    func tableView(_ tableView: UITableView, titleForHeaderInSection section: Int) -> String? {
        return "ğŸ¿ë°•ìŠ¤ì˜¤í”¼ìŠ¤(ì˜í™”ì§„í¥ìœ„ì›íšŒì œê³µ: \(makeYesterdayString()))ğŸ¿"
    }

    func tableView(_ tableView: UITableView, titleForFooterInSection section: Int) -> String? {
        return "by choimu"
    }

    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
        guard let dest = segue.destination as? DetailViewController,
              let indexPath = table.indexPathForSelectedRow else { return }
        dest.movieName = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row].movieNm ?? ""
    }
}

class MyTableViewCell: UITableViewCell {
    @IBOutlet weak var movieName: UILabel!
    @IBOutlet weak var audiAccumulate: UILabel!
    @IBOutlet weak var audiCount: UILabel!
}

class DetailViewController: UIViewController {
    var movieName: String?
    
    override func viewDidLoad() {
        super.viewDidLoad()
        // movieNameì„ ì‚¬ìš©í•˜ëŠ” ì¶”ê°€ ì„¤ì •
    }
}

``'










<br>
<br>
<br>
<br>
<br>
<br>
<br>

## ì¶œì²˜
---
* Smile Hanì˜ iOS í”„ë¡œê·¸ë˜ë° ì‹¤ë¬´, í•œì„±í˜„(ì¶œíŒ ì˜ˆì •), PPTë¡œ ì œê³µ  
* Do it! ìŠ¤ìœ„í”„íŠ¸ë¡œ ì•„ì´í° ì•± ë§Œë“¤ê¸° ì…ë¬¸(ê°œì • 7íŒ)(ì´ì§€ìŠ¤í¼ë¸”ë¦¬ì‹±,ì†¡í˜¸ì •, ì´ë²”ê·¼, 2023.1)  
* í•µì‹¬ë§Œ ê³¨ë¼ ë°°ìš°ëŠ” SwiftUI ê¸°ë°˜ì˜ iOS í”„ë¡œê·¸ë˜ë°(ì œì´í, ë‹ ìŠ¤ë¯¸ìŠ¤, 2023.12)  
  * https://www.techotopia.com/index.php/IOS_iPhone_iPad_eBooks  
* ìŠ¤ìœ„í”„íŠ¸ í”„ë¡œê·¸ë˜ë°(Swift 5) 3íŒ(í•œë¹›ë¯¸ë””ì–´, ì•¼ê³°, 2019.10)  
* ê¼¼ê¼¼í•œ ì¬ì€ ì”¨ì˜ ìŠ¤ìœ„í”„íŠ¸ ê¸°ë³¸í¸ (ë£¨ë¹„í˜ì´í¼, ì´ì¬ì€, 2018.05)  
* ê¼¼ê¼¼í•œ ì¬ì€ ì”¨ì˜ ìŠ¤ìœ„í”„íŠ¸ ì‹¤ì „í¸ (Swift) (ë£¨ë¹„í˜ì´í¼, ì´ì¬ì€, 2018.08)  
* ê¼¼ê¼¼í•œ ì¬ì€ ì”¨ì˜ Swift ë¬¸ë²•í¸ (ë£¨ë¹„í˜ì´í¼, ì´ì¬ì€, 2017.12)  