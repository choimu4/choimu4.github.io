---
layout: post
title: iOS 프로그래밍 실무 8
subtitle: iOS 프로그래밍 실무 8 
author: 민욱 최 
excerpt_image: ../assets/images/swift_banner.PNG
categories: Swift
banner:
  image: ../assets/images/swift_banner.PNG
  opacity: 0.618
  background: "#000"
  height: "100vh"
  min_height: "38vh"
  heading_style: "font-size: 3.5em; font-weight: bold; text-decoration: underline"
  subheading_style: "color: gold"
tags: iOS Swift Induk
---
       
## 인터넷에서 소스를 다운로드 했을 때
---

![image](https://github.com/choimu4/choimu4.github.io/assets/155925706/06e29807-1e74-4e99-b9e2-3b1a296e344f)   
Trsut and Open을 클릭해서 Open한다.

![image](https://github.com/choimu4/choimu4.github.io/assets/155925706/ac2d7d9f-b2d7-4e92-bde4-9cfb5fc17046)  
실행을 해도 아무것도 보이지 않을 수 있다.  

![image](https://github.com/choimu4/choimu4.github.io/assets/155925706/b4182985-41fb-4c23-b66d-a8c39b3a3c50)  
Xcode 버전이 맞지 않아서 그런 것이니 Minimum Deployment를 낮추면 정상적으로 보인다.s


## 네트워킹
---   

![image](https://github.com/choimu4/choimu4.github.io/assets/155925706/ea3212c8-4b23-48ed-a923-90a79b55ed8e)  

### 1단계 URL 만들기

``` Swift
guard let url = URL(string: movieURL) else {return}
```

failurble initializer가 사용됨 -> optional이 리턴됨

따라서 guard let으로 언래핑함

![image](https://github.com/choimu4/choimu4.github.io/assets/155925706/49df24e5-78ea-4b8c-a7fd-c7652ba36df9)

### 2단계 URLSession 만들기

``` Swift
let session = URLSession(configuration: .default)
```

### 3단계 URlSession 인스턴스에게 task 주기

``` Swift
let task = session.dataTask(with: url)  { data, response, error in
    if error != nil {
        print(error!)
        return
    }
    guard let JSONdata = data else { return }
    print(JSONdata)
}
```   

소스를 수정하고 실행해도 동작을 하지 않는다.

### 4단계 task를 resume()

``` Swift
task.resume()
```
새로 초기화된 작업은 일시 중단된 상태에서 시작되므로, 이 메서드를 호출하여 작업을 시작해야함

### data를 String으로 찍어보기

``` Swift
guard let JSONdata = data else { return }
let dataString = String(data: JSONdata, encoding: .utf8)
print(dataString!)
```

### 예외 처리

예외 처리를 하지 않아 오류 발생
![image](https://github.com/choimu4/choimu4.github.io/assets/155925706/a8eff8be-d84b-41f5-bc79-6eb0ef4754d1)

![image](https://github.com/choimu4/choimu4.github.io/assets/155925706/cc7a6787-07f6-4a38-9f44-66ac65256718)
수정한 사진


### cell에 data 적용

``` Swift
func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    let cell = tableView.dequeueReusableCell(withIdentifier: "myCell", for: indexPath) as! MyTableViewCell
    cell.movieName.text = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row].movieNm
    //print(indexPath.description)
    return cell
}
```

### table읋 reload 해줘야한다!!

![image](https://github.com/choimu4/choimu4.github.io/assets/155925706/8e0bc305-c5e5-4403-a267-185f8a9e76de)

사진 처럼 수정하니 main thread에서 동작을 해야한다는 오류가 발생했다.

``` Swift
DispatchQueue.main.async {
    self.table.reloadData()
}
```
이렇게 수정해서 main thread에서 처리하면 된다.

### 완성된 getData() 

``` Swift
func getData() {
    guard let url = URL(string: movieURL) else {return}
    let session = URLSession(configuration: .default)
    let task = session.dataTask(with: url)  { data, response, error in
        if error != nil {
            print(error!)
            return
        }
        guard let JSONdata = data else { return }
        print(JSONdata)
        let decoder = JSONDecoder()
        do {
            let decodedData = try decoder.decode(MovieData.self, from: JSONdata)
            self.movieData = decodedData
            DispatchQueue.main.async {
                self.table.reloadData()
            }
        }catch{
            
        }        }
    task.resume()
}
```

## 어제의 날짜를 기준으로 자동으로 조회하는 소스를 추가한 버젼
---

``` Swift
//
//  ViewController.swift
//  MovieCMU
//
//  Created by Induk-cs  on 2024/05/02.
//

import UIKit

struct MovieData : Codable {
    let boxOfficeResult : BoxOfficeResult
}
struct BoxOfficeResult : Codable {
    let dailyBoxOfficeList : [DailyBoxOfficeList]
}
struct DailyBoxOfficeList : Codable {
    let movieNm : String
    let audiCnt : String
    let audiAcc : String
    let rank : String
}

class ViewController: UIViewController, UITableViewDelegate, UITableViewDataSource {
    @IBOutlet weak var table: UITableView!
    var movieData : MovieData?
    var movieURL = "https://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=d9dfbf5b0a8b138015b48bd3b9ecfe2b&targetDt="
    
    override func viewDidLoad() {
        super.viewDidLoad()
        table.dataSource = self
        table.delegate = self
        
        movieURL += makeYesterdayString()
        
        getData()
        // Do any additional setup after loading the view.
    }
    func makeYesterdayString() -> String {
        let today = Date()
        let calendar = Calendar.current
        let yesterday = calendar.date(byAdding: .day, value: -1, to: today)!
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyyMMdd"
        let yesterdayString = formatter.string(from: yesterday)
        return yesterdayString
    }
    func getData() {
        guard let url = URL(string: movieURL) else {return}
        let session = URLSession(configuration: .default)
        let task = session.dataTask(with: url)  { data, response, error in
            if error != nil {
                print(error!)
                return
            }
            guard let JSONdata = data else { return }
            print(JSONdata)
            let decoder = JSONDecoder()
            do {
                let decodedData = try decoder.decode(MovieData.self, from: JSONdata)
                self.movieData = decodedData
                DispatchQueue.main.async {
                    self.table.reloadData()
                }
            }catch{
                
            }        }
        task.resume()
    }
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return 10
    }
    
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = tableView.dequeueReusableCell(withIdentifier: "myCell", for: indexPath) as! MyTableViewCell
        cell.movieName.text = movieData?.boxOfficeResult.dailyBoxOfficeList[indexPath.row].movieNm
        //print(indexPath.description)
        return cell
    }
    func numberOfSections(in tableView: UITableView) -> Int {
        return 1
    }
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        //print(indexPath.description)
    }
}
```





<br>
<br>
<br>
<br>
<br>
<br>
<br>

## 출처
---
* Smile Han의 iOS 프로그래밍 실무, 한성현(출판 예정), PPT로 제공  
* Do it! 스위프트로 아이폰 앱 만들기 입문(개정 7판)(이지스퍼블리싱,송호정, 이범근, 2023.1)  
* 핵심만 골라 배우는 SwiftUI 기반의 iOS 프로그래밍(제이펍, 닐 스미스, 2023.12)  
  * https://www.techotopia.com/index.php/IOS_iPhone_iPad_eBooks  
* 스위프트 프로그래밍(Swift 5) 3판(한빛미디어, 야곰, 2019.10)  
* 꼼꼼한 재은 씨의 스위프트 기본편 (루비페이퍼, 이재은, 2018.05)  
* 꼼꼼한 재은 씨의 스위프트 실전편 (Swift) (루비페이퍼, 이재은, 2018.08)  
* 꼼꼼한 재은 씨의 Swift 문법편 (루비페이퍼, 이재은, 2017.12)  